// awoo pixel v1.9.0 | Published By Awoo Front-End Team MIT License
!function(y,n,w){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,u=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return u}}(e,t)||function(e,t){var n;if(e)return"string"==typeof e?r(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function o(e,t,n){(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function S(){S=function(){return o};var o={},e=Object.prototype,s=e.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",a=t.toStringTag||"@@toStringTag";function i(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(e){i=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a,i,o,u,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype),r=new b(r||[]);return c(t,"_invoke",{value:(a=e,i=n,o=r,u="suspendedStart",function(e,t){if("executing"===u)throw new Error("Generator is already running");if("completed"===u){if("throw"===e)throw t;return O()}for(o.method=e,o.arg=t;;){var n=o.delegate;if(n){n=function e(t,n){var r=n.method,a=t.iterator[r];if(void 0===a)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=void 0,e(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;r=l(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,p;a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,p):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}(n,o);if(n){if(n===p)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===u)throw u="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);u="executing";n=l(a,i,o);if("normal"===n.type){if(u=o.done?"completed":"suspendedYield",n.arg===p)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(u="completed",o.method="throw",o.arg=n.arg)}})}),t}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=u;var p={};function f(){}function m(){}function d(){}var t={},g=(i(t,r,function(){return this}),Object.getPrototypeOf),g=g&&g(g(P([]))),h=(g&&g!==e&&s.call(g,r)&&(t=g),d.prototype=f.prototype=Object.create(t));function v(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function y(o,u){var t;c(this,"_invoke",{value:function(n,r){function e(){return new u(function(e,t){!function t(e,n,r,a){var i,e=l(o[e],o,n);if("throw"!==e.type)return(n=(i=e.arg).value)&&"object"==k(n)&&s.call(n,"__await")?u.resolve(n.__await).then(function(e){t("next",e,r,a)},function(e){t("throw",e,r,a)}):u.resolve(n).then(function(e){i.value=e,r(i)},function(e){return t("throw",e,r,a)});a(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}})}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function P(t){if(t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(s.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:O}}function O(){return{value:void 0,done:!0}}return c(h,"constructor",{value:m.prototype=d,configurable:!0}),c(d,"constructor",{value:m,configurable:!0}),m.displayName=i(d,a,"GeneratorFunction"),o.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,a,"GeneratorFunction")),e.prototype=Object.create(h),e},o.awrap=function(e){return{__await:e}},v(y.prototype),i(y.prototype,n,function(){return this}),o.AsyncIterator=y,o.async=function(e,t,n,r,a){void 0===a&&(a=Promise);var i=new y(u(e,t,n,r),a);return o.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},v(h),i(h,a,"Generator"),i(h,r,function(){return this}),i(h,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=P,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return i.type="throw",i.arg=n,r.next=e,t&&(r.method="next",r.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],i=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var o=s.call(a,"catchLoc"),u=s.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}var i=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,a=this.tryEntries[t];if(a.tryLoc===e)return"throw"===(n=a.completion).type&&(r=n.arg,x(a)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},o}function s(e,t,n,r,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function c(u){return function(){var e=this,o=arguments;return new Promise(function(t,n){var r=u.apply(e,o);function a(e){s(r,t,n,a,i,"next",e)}function i(e){s(r,t,n,a,i,"throw",e)}a(void 0)})}}function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}function p(e,t,n){t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1})}function f(e){e=function(e,t){if("object"!==k(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===k(e)?e:String(e)}function m(e,t,n,r){if(n!==location.href&&(b.params={},!r)){b.params.pageid=function(){return O.get("pageid")},new C("pageClose",P.now()),O.set("pageid",P.guid()),b.params.pageid=function(){return O.get("pageid")},new C("viewPage",P.now());for(var a=0,i=w.queue.length;a<i;a++)w.process.apply(w,w.queue[a]);w.queue=[]}}var b={id:"",params:{},version:"v1.9.0",isFetchApi:!1},P=function(){function t(){u(this,t)}var n;return p(t,null,[{key:"isPresent",value:function(e){return null!=e&&""!==e}},{key:"now",value:function(){return parseInt((new Date).getTime(),10)}},{key:"uuidv4",value:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})}},{key:"createAuid",value:function(){try{JSON.parse(E.get("nununi-user"))}catch(e){E.delete("nununi-user")}E.exists("nununi-user")||(E.set("nununi-user",JSON.stringify({data:this.guid()})),w.queue.unshift(["param",{}],["event","firstVisit"]))}},{key:"decodeUri",value:function(t){try{return decodeURIComponent(t)}catch(e){return t}}},{key:"setupUTM",value:function(){E.delUtms(),E.setUtms()}},{key:"clearAllQueues",value:function(){y.awooConfigManager.pixel.viewEventQueue.clear(),y.awooConfigManager.pixel.searchEventQueue.clear(),y.awooConfigManager.pixel.clickProductEventQueue.clear(),y.awooConfigManager.pixel.addToCartEventQueue.clear()}},{key:"clearQueue",value:function(e){y.awooConfigManager.pixel[e].clear()}},{key:"guid",value:function(){return b.version+"-xxxxxxxx-".replace(/[x]/g,function(e){var t=36*Math.random()|0;return("x"==e?t:3&t|8).toString(36)})+(+new Date).toString(36)+"-"+this.uuidv4().substring(0,8)}},{key:"optionalData",value:function(e){return t.isPresent(e)?"object"===k(e)?t.optionalData(JSON.stringify(e)):"function"==typeof e?t.optionalData(e()):String(e):""}},{key:"fetchPixelOnData",value:(n=c(S().mark(function e(i){var o,u,s;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b.isFetchApi)return e.abrupt("return",Promise.reject());e.next=2;break;case 2:return b.isFetchApi=!0,o="".concat("pixel_on_cached_data_v1.9.0"),u="pixel_on_cached_timestamp",s="".concat("https://api.awoo.org"),e.abrupt("return",new Promise(function(){var n=c(S().mark(function e(r,t){var n,a;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=E.get(o),a=E.get(u),n&&a&&Date.now()-parseInt(a,10)<36e5?r(JSON.parse(n)):(Object.keys(localStorage).filter(function(e){return e.includes("pixel_on_cached_data")}).forEach(function(e){localStorage.removeItem(e)}),fetch("".concat(s,"/nununi/sdk/").concat(i,"/customerCustomizedConfig?groups[]=system")).then(function(){var t=c(S().mark(function e(t){var n;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:if((n=e.sent).result.hasOwnProperty("system")){e.next=9;break}return y.awoo_pixelOn=!1,E.set(o,JSON.stringify({errmsg:"api error",result:{system:{fields:{pixelOn:!1}}}})),E.set(u,Date.now().toString()),r(n),e.abrupt("return");case 9:E.set(o,JSON.stringify(n)),E.set(u,Date.now().toString()),r(n);case 12:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){y.awoo_pixelOn=!1,E.set(o,JSON.stringify({errmsg:"api error",result:{system:{fields:{pixelOn:!1}}}})),E.set(u,Date.now().toString()),t(e)}));case 3:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}()));case 8:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),t}(),t=function(){function e(){u(this,e)}return p(e,null,[{key:"nameAndVersion",value:function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}},{key:"isMobile",value:function(){return"ontouchstart"in y||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints}},{key:"userAgent",value:function(){return y.navigator.userAgent}},{key:"deviceChannel",value:function(){var e=navigator.userAgent||navigator.vendor||y.opera;if(/windows phone/i.test(e))return"Windows Phone";if(/android/i.test(e))return"Android";if(/iPad|iPhone|iPod/.test(e)&&!y.MSStream)return"iOS";for(var t=["Windows","Android","Unix","Mac","Linux","BlackBerry"],n=0;n<t.length;n++)if(new RegExp(t[n],"i").test(e))return t[n];return"web"}}]),e}(),d=function(){function e(){u(this,e)}return p(e,null,[{key:"getParameterByName",value:function(e,t){t=t||y.location.href,e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}},{key:"externalHost",value:function(e){return e.hostname!=location.hostname&&0===e.protocol.indexOf("http")}}]),e}(),O=function(){function e(){u(this,e)}return p(e,null,[{key:"prefix",value:function(){return"awoo_"}},{key:"set",value:function(e,t){sessionStorage.setItem("".concat(this.prefix()).concat(e),t)}},{key:"get",value:function(e){e="".concat(this.prefix()).concat(e);return sessionStorage.getItem(e)?sessionStorage.getItem(e):null}},{key:"delete",value:function(e){this.set(e,"")}},{key:"exists",value:function(e){return P.isPresent(this.get(e))}}]),e}(),E=function(){function e(){u(this,e)}return p(e,null,[{key:"prefix",value:function(){return"awoo_"}},{key:"set",value:function(e,t){localStorage.setItem("".concat(this.prefix()).concat(e),t)}},{key:"get",value:function(e){e="".concat(this.prefix()).concat(e);return localStorage.getItem(e)?localStorage.getItem(e):null}},{key:"delete",value:function(e){this.set(e,"")}},{key:"exists",value:function(e){return P.isPresent(this.get(e))}},{key:"setUtms",value:function(){for(var e=["utm_source","utm_medium","utm_term","utm_content","utm_campaign","utm_source_platform","utm_creative_format","utm_marketing_tactic"],t=!1,n=0,r=e.length;n<r;n++)if(P.isPresent(d.getParameterByName(e[n]))){t=!0;break}if(t){for(var a,i={},n=0,r=e.length;n<r;n++)a=d.getParameterByName(e[n]),P.isPresent(a)&&(i[e[n]]=a);this.set("utm",JSON.stringify(i))}}},{key:"getUtm",value:function(e){var t;if(this.exists("utm"))return e in(t=JSON.parse(null!=(t=this.get("utm"))?t:""))?t[e]:""}},{key:"delUtms",value:function(){this.delete("utm")}}]),e}(),j=function(){function r(){u(this,r)}return p(r,null,[{key:"generateSessionId",value:function(){P.clearAllQueues();var e=P.guid();return E.set("sid",e),E.set("lastActivityTime",(new Date).getTime().toString()),b.params={pageid:function(){return O.get("pageid")}},new C("sessionStart",P.now()),e}},{key:"resetSessionId",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=(new Date).getTime(),n=E.get("lastActivityTime"),t=n?t-parseInt(n):0;r.sessionExpiration<=t&&(b.params={msg:function(){return"session id超過24小時"},pageid:function(){return O.get("pageid")}},e||new C("pageClose",P.now()),b.params={},r.generateSessionId())}},{key:"resetIdleTimer",value:function(){clearTimeout(r.idleTimeout),E.set("lastIdleTime",(new Date).getTime().toString()),r.idleTimeout=setTimeout(function(){b.params={msg:function(){return"使用者閒置超過30分鐘"},pageid:function(){return O.get("pageid")}},new C("pageClose",P.now()),b.params={},r.generateSessionId(),clearTimeout(r.idleTimeout),E.set("lastIdleTime","")},r.idleThreshold)}},{key:"onUserActivity",value:function(){r.channel.postMessage({isPageActive:!0}),r.resetIdleTimer()}},{key:"initialize",value:function(){var e=E.get("sid"),e=(r.channel.onmessage=function(e){e.data.isPageActive&&clearTimeout(r.idleTimeout)},e?r.resetSessionId(!0):r.generateSessionId(),(new Date).getTime()),t=E.get("lastIdleTime"),e=t?e-parseInt(t):0;t&&r.idleThreshold<=e&&(r.generateSessionId(),E.set("lastIdleTime","")),setInterval(function(){r.resetSessionId()},1e3),n.addEventListener("mousemove",r.onUserActivity),n.addEventListener("keydown",r.onUserActivity),n.addEventListener("scroll",r.onUserActivity),n.addEventListener("mousedown",r.onUserActivity)}}]),r}(),g=(o(j,"idleTimeout",void 0),o(j,"idleThreshold",18e5),o(j,"sessionExpiration",864e5),o(j,"channel",new BroadcastChannel("awoo_channel")),function(){function t(e){u(this,t),this.name=e,this.queue=E.exists(e)?JSON.parse(E.get(e)):[]}return p(t,[{key:"add",value:function(e){Array.isArray(this.queue)&&100<=this.queue.length&&this.remove(),"string"==typeof this.queue&&(this.queue=JSON.parse(this.queue)),this.queue.push(e),E.set(this.name,JSON.stringify(this.queue))}},{key:"remove",value:function(){this.queue.shift(),E.set(this.name,JSON.stringify(this.queue))}},{key:"get",value:function(){return E.exists(this.name)?JSON.parse(E.get(this.name)):this.queue}},{key:"clear",value:function(){E.set(this.name,JSON.stringify([])),this.queue=[]}},{key:"size",value:function(){return this.queue.length}},{key:"replace",value:function(e){this.queue=e,E.set(this.name,JSON.stringify(this.queue))}}]),t}()),C=function(){function r(e,t,n){u(this,r),this.params=[],this.objectParams={},this.event=e,this.timestamp=t,this.optional=P.optionalData(n),this.buildParams(),y.hasOwnProperty("awoo_pixelOn")&&!1===y.awoo_pixelOn||this.send()}return p(r,[{key:"buildParams",value:function(){var e,t=this.getAttribute();for(e in t)t.hasOwnProperty(e)&&(this.setParam(e,t[e](e)),this.objectParams[e]=t[e](e)||"")}},{key:"getAttribute",value:function(){var e=this;return x({cid:function(){var e;return b.id||(null!=(e=null==(e=JSON.parse(E.get("client_id")))?void 0:e.data)?e:"")},dc:function(){return t.deviceChannel()},auid:function(){return JSON.parse(E.get("nununi-user")).data},ev:function(){return e.event},ver:function(){return b.version},ul:function(){return navigator.language},url:function(){return y.location.href},rl:function(){return n.referrer},ht:function(){return e.timestamp},sid:function(e){return E.get(e)},de:function(){return n.characterSet},sr:function(){return y.screen.width+"x"+y.screen.height},vp:function(){return y.innerWidth+"x"+y.innerHeight},cd:function(){return y.screen.colorDepth},dt:function(){return n.title},bn:function(){return t.nameAndVersion()},md:function(){return t.isMobile()},ua:function(){return t.userAgent()},tz:function(){return(new Date).getTimezoneOffset()},utm_source:function(e){return E.getUtm(e)},utm_medium:function(e){return E.getUtm(e)},utm_term:function(e){return E.getUtm(e)},utm_content:function(e){return E.getUtm(e)},utm_campaign:function(e){return E.getUtm(e)},utm_source_platform:function(e){return E.getUtm(e)},utm_creative_format:function(e){return E.getUtm(e)},utm_marketing_tactic:function(e){return E.getUtm(e)},ed:function(){return e.optional},source:function(e){return O.exists(e)?O.get(e):"web"},appver:function(e){return O.exists(e)?O.get(e):""}},b.params)}},{key:"setParam",value:function(e,t){P.isPresent(t)?this.params.push("".concat(e,"=").concat(encodeURIComponent(t))):this.params.push("".concat(e,"="))}},{key:"send",value:function(){var n=this;if(this.event.includes("view")&&"viewTag"!==this.event&&"viewProductRecommendation"!==this.event&&(y.awooConfigManager.pixel.viewEventQueue.add({event:this.event,timestamp:this.timestamp,params:this.objectParams}),this.event.toLowerCase().includes("product"))){if(!this.objectParams.pid&&!this.objectParams.pname)return;var e=y.awooConfigManager.pixel.clickProductEventQueue.get().map(function(e){var t;return null!=e&&null!=(t=e.params)&&t.pid&&n.objectParams.pid&&(null==e||null==(t=e.params)?void 0:t.pid)===n.objectParams.pid||null!=e&&null!=(t=e.params)&&t.pname&&n.objectParams.pname&&(null==e||null==(t=e.params)?void 0:t.pname)===n.objectParams.pname?x(x({},e),{},{params:x(x({},null==e?void 0:e.params),{},{url:n.objectParams.url})}):e});y.awooConfigManager.pixel.clickProductEventQueue.replace(e)}if("search"!==this.event&&!this.event.toLowerCase().includes("suggestion")||y.awooConfigManager.pixel.searchEventQueue.add({event:this.event,timestamp:this.timestamp,params:this.objectParams}),"clickProduct"===this.event){e=y.awooConfigManager.pixel.clickProductEventQueue.get();if(!this.objectParams.pid&&!this.objectParams.pname)return;var t=e.findIndex(function(e){var t;return!!(null!=(t=e.params)&&t.pid&&null!=(t=n.objectParams)&&t.pid&&(null==(t=e.params)?void 0:t.pid)===(null==(t=n.objectParams)?void 0:t.pid)||null!=(t=e.params)&&t.pname&&null!=(t=n.objectParams)&&t.pname&&(null==(t=e.params)?void 0:t.pname)===(null==(e=n.objectParams)?void 0:e.pname))});-1!==t?(e[t].params=this.objectParams,y.awooConfigManager.pixel.clickProductEventQueue.replace(e)):y.awooConfigManager.pixel.clickProductEventQueue.add({event:this.event,timestamp:this.timestamp,params:this.objectParams})}if("addToCart"===this.event){t=y.awooConfigManager.pixel.addToCartEventQueue.get();if(!this.objectParams.pid&&!this.objectParams.pname)return;e=t.findIndex(function(e){var t;return!!(null!=(t=e.params)&&t.pid&&null!=(t=n.objectParams)&&t.pid&&(null==(t=e.params)?void 0:t.pid)===(null==(t=n.objectParams)?void 0:t.pid)||null!=(t=e.params)&&t.pname&&null!=(t=n.objectParams)&&t.pname&&(null==(t=e.params)?void 0:t.pname)===(null==(e=n.objectParams)?void 0:e.pname))});-1!==e?(t[e].params=this.objectParams,t[e].params=this.objectParams,y.awooConfigManager.pixel.addToCartEventQueue.replace(t)):y.awooConfigManager.pixel.addToCartEventQueue.add({event:this.event,timestamp:this.timestamp,params:this.objectParams})}y.navigator.sendBeacon?this.sendBeacon():this.sendImage()}},{key:"sendBeacon",value:function(){y.navigator.sendBeacon(this.getSourceUrl("logs"))}},{key:"sendImage",value:function(){this.img=n.createElement("img"),this.img.src=this.getSourceUrl("pixel.gif"),this.img.style.display="none",this.img.width=1,this.img.height=1,n.getElementsByTagName("body")[0].appendChild(this.img)}},{key:"getSourceUrl",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return"".concat("https://pixel-service.awoo.org/awoo-pixel/sdk/v1","/").concat(e,"?").concat(this.params.join("&"))}}]),r}(),e=(w.process=function(e,t,n){if("init"===e||"info"===e||y.hasOwnProperty("awoo_pixelOn"))if("init"===e)if(b.id=t,E.set("client_id",JSON.stringify({data:t})),y.hasOwnProperty("awoo_pixelOn")){j.initialize(),b.params={},b.params.pageid=function(){return O.get("pageid")},new C("viewPage",P.now());for(var r=0,a=w.queue.length;r<a;r++)"info"!==w.queue[r][0]&&"init"!==w.queue[r][0]&&w.process.apply(w,w.queue[r]);w.queue=[]}else P.fetchPixelOnData(t).then(function(e){e.result.hasOwnProperty("system")&&(y.awoo_pixelOn=e.result.system.fields.pixelOn,y.awooConfigManager.pixel.pixelOn=y.awoo_pixelOn),j.initialize(),b.params={},b.params.pageid=function(){return O.get("pageid")},new C("viewPage",P.now());for(var t=0,n=w.queue.length;t<n;t++)"info"!==w.queue[t][0]&&"init"!==w.queue[t][0]&&w.process.apply(w,w.queue[t]);w.queue=[]}).catch(function(){});else if("info"===e)"object"===k(t)&&(t.hasOwnProperty("source")&&""!==t.source&&O.set("source",t.source),t.hasOwnProperty("appVer")&&""!==t.appVer&&O.set("appver",t.appVer),t.hasOwnProperty("auid")&&""!==t.auid&&E.set("nununi-user",JSON.stringify({data:t.auid})),t.hasOwnProperty("sid"))&&""!==t.sid&&E.set("sid",t.sid);else if("param"===e){if(b.params={},"string"==typeof t)b.params[t]=function(){return n};else if("object"===k(t)){var i=function(){var e;return"tname"===o?(b.params[o]=function(e){return P.optionalData(P.decodeUri(t[e]))},"continue"):"pds"===o?(e=t[o].map(function(e){e=function(e){var t,n,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=null!=(n=e[t])?n.toString():"");return r}(e);return x(x({},e),{},{ppr:e.ppr.replace(/[^\d.]/g,""),popr:e.popr.replace(/[^\d.]/g,""),pqt:e.pqt.replace(/[^\d.]/g,"")})}),b.params[o]=function(){return P.optionalData(e)},"continue"):"ppr"===o||"popr"===o||"pqt"===o||"pc"===o||"rv"===o?(b.params[o]=function(e){return P.optionalData(t[e].toString().replace(/[^\d.]/g,""))},"continue"):void(b.params[o]=function(e){return P.optionalData(t[e])})};for(o in t)i()}else if("function"==typeof t&&"object"===k(t()))for(var o in t())b.params[o]=function(e){return P.optionalData(t[e])}}else{var u,s,c,l,p,f,m,d,g,h,v;"event"===e&&"viewPage"!==t&&("clickProduct"===t||"addToCart"===t?((d=b.params.ser?b.params.ser("ser"):"").toLowerCase().includes("search")?(u=y.awooConfigManager.pixel.viewEventQueue.get().filter(function(e){return"viewSearchResultPage"===e.event}).sort(function(e,t){return e.timestamp-t.timestamp}),(s=u.length?u[u.length-1].params.sinput:null)&&u[u.length-1].params.url===location.href&&(b.params.con=function(){return s},b.params.ser=function(){return u[u.length-1].params.ser})):d.toLowerCase().includes("page")?(c=y.awooConfigManager.pixel.viewEventQueue.get().filter(function(e){return"viewTagPage"===e.event}).sort(function(e,t){return e.timestamp-t.timestamp})).length&&c[c.length-1].params.url===location.href&&(b.params.con=function(){return c[c.length-1].params.tname}):b.params.con=b.params.con||function(){return""},"addToCart"===t?(d=y.awooConfigManager.pixel.clickProductEventQueue.get(),l=b.params.pid?b.params.pid("pid"):"",p=b.params.pname?b.params.pname("pname"):"",(l||p)&&(f=d.find(function(e){var t;return!!(null!=e&&null!=(t=e.params)&&t.pid&&l&&(null==e||null==(t=e.params)?void 0:t.pid)===l||null!=e&&null!=(t=e.params)&&t.pname&&p&&(null==e||null==(t=e.params)?void 0:t.pname)===p)}))&&location.href===f.params.url&&(b.params.ser=function(){return f.params.ser},b.params.con=function(){return f.params.con})):b.params.con=b.params.con||function(){return""},b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n)):"viewSearchResultPage"===t?(0<(d=y.awooConfigManager.pixel.searchEventQueue.get().sort(function(e,t){var n=e.timestamp,r=t.timestamp,e=e.params.ser,t=t.params.ser;return n<r?-1:r<n?1:e<t?-1:t<e?1:0})).length&&(m=d[d.length-1],b.params.ser=function(){return m.params.ser.toLowerCase().includes("termsuggestion")?"sitesearch+termSuggestion":"sitesearch"}),b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n)):"search"===t?(b.params.salt=function(){return!1},E.exists("st")&&(d=E.get("st"),(g=(new Date).getTime())-+d<=12e4)&&2e3<g-+d&&(b.params.salt=function(){return!0}),E.set("st",(new Date).getTime()),b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n),delete b.params.salt):"searchInput"===t?(y.awooInputTimeout&&clearTimeout(y.awooInputTimeout),y.awooInputTimeout=setTimeout(function(){b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n)},3e3)):"checkout"===t?(h="",h=P.guid(),E.set("trid",h),b.params.trid=function(){return h},b.params.pageid=function(){return O.get("pageid")},(v=b.params.pds&&JSON.parse(b.params.pds("pds"))||[]).length&&(v=v.map(function(n){var e=y.awooConfigManager.pixel.addToCartEventQueue.get().find(function(e){var t;return!!(null!=(t=e.params)&&t.pid&&n.pid&&(null==(t=e.params)?void 0:t.pid)===n.pid||null!=(t=e.params)&&t.pname&&n.pname&&(null==(t=e.params)?void 0:t.pname)===n.pname)});return x(x({},n),{},e?{ser:e.params.ser,con:e.params.con}:{ser:"",con:""})})),b.params.pds=function(){return JSON.stringify(v)},new C(t,P.now(),n)):"purchase"===t?(h="",h=E.exists("trid")?E.get("trid"):P.guid(),b.params.trid=function(){return h},(v=b.params.pds&&JSON.parse(b.params.pds("pds"))||[]).length&&(v=v.map(function(n){var e=y.awooConfigManager.pixel.addToCartEventQueue.get(),t=e.find(function(e){var t;return!!(null!=(t=e.params)&&t.pid&&n.pid&&(null==(t=e.params)?void 0:t.pid)===n.pid||null!=(t=e.params)&&t.pname&&n.pname&&(null==(t=e.params)?void 0:t.pname)===n.pname)}),r=e.findIndex(function(e){var t;return!!(null!=(t=e.params)&&t.pid&&n.pid&&(null==(t=e.params)?void 0:t.pid)===n.pid||null!=(t=e.params)&&t.pname&&n.pname&&(null==(t=e.params)?void 0:t.pname)===n.pname)});return y.awooConfigManager.pixel.addToCartEventQueue.replace(e.filter(function(e,t){return t!==r})),x(x({},n),{},t?{ser:t.params.ser,con:t.params.con}:{ser:"",con:""})})),b.params.pds=function(){return JSON.stringify(v)},b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n),y.awooConfigManager.pixel.viewEventQueue.clear(),y.awooConfigManager.pixel.searchEventQueue.clear(),y.awooConfigManager.pixel.clickProductEventQueue.clear()):"viewPage"!==t&&"pageClose"!==t&&(b.params.pageid=function(){return O.get("pageid")},new C(t,P.now(),n)))}else w.queue.push([e,t,n])},c(S().mark(function e(){var t,n;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(O.set("pageid",P.guid()),P.createAuid(),P.setupUTM(),y.awooMethods={debounce:P.debounce},y.awooInputTimeout=null,y.awooConfigManager=Object.assign(y.awooConfigManager||{},{pixel:{pixelOn:y.awoo_pixelOn||!1,searchEventQueue:new g("searchEventQueue"),viewEventQueue:new g("viewEventQueue"),clickProductEventQueue:new g("clickProductEventQueue"),addToCartEventQueue:new g("addToCartEventQueue")},pixelInstalled:!0}),t=0,n=w.queue.length;t<n;t++)"info"!==w.queue[t][0]&&"init"!==w.queue[t][0]||w.process.apply(w,w.queue[t]);case 7:case"end":return e.stop()}},e)}))(),["pushState","replaceState"].forEach(function(a){y.history["_"+a]=y.history[a],y.history[a]=new Proxy(y.history[a],{apply:function(e,t,n){var r=i(n,3),r=(r[0],r[1],r[2]);return m(0,0,r,"replaceState"===a),e.apply(t,n)}})}),y.addEventListener("popstate",function(e){m(e.state,0,"",!1)}),"object"===("undefined"==typeof safari?"undefined":k(safari))&&safari.pushNotification);0 in self;y.addEventListener("beforeunload",function(){b.pageCloseOnce||(b.pageCloseOnce=!0,b.params={},b.params.pageid=function(){return O.get("pageid")},new C("pageClose",P.now(),function(){if(P.isPresent(b.externalHost)&&P.now()-b.externalHost.time<5e3)return b.externalHost.link}))})}(window,document,window.awpx);